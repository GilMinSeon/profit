<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.or.profit.mapper.MypageMapper">


    <!-- 회원 기본정보 가져오기 -->
    <select id="selectMemberInfo" parameterType="String" resultType="egovMap">
        select 
        	member_name, 
        	member_gender, 
        	member_mobile
		from 
			member
		where 
			member_id=#{memberId}
    </select>
    
    
    <!-- 프로세스테이블에 정보 추가 -->
    <insert id="insertProcess" parameterType="ProcessVO">
    
    	<selectKey resultType="string" keyProperty="fileSeq" order="BEFORE">
        		select 
					NVL(max(to_number(file_seq)),0)
        		from 
        			attach_file
    	</selectKey>
      		  
        <![CDATA[
        insert 
        	into 
        process
        	(
        		process_seq,
				member_id,
				file_seq,
				trainer_award,
				trainer_career,
				trainer_gym,
				process_status,
				process_finish_date,
				admin_memo,
				in_user_id,
				in_date,
				up_user_id,
				up_date
        	)
			values(
				(
					select 
						NVL(max(to_number(process_seq)),0) + 1 
					from process
				), 
				#{memberId}, 
				#{fileSeq},
				#{trainerAward}, 
				#{trainerCareer}, 
				#{trainerGym},
				'A',
				sysdate+14,
        		null, 
        		#{inUserId}, 
        		sysdate, 
        		#{upUserId}, 
        		sysdate
        		)
        ]]>
	        
    </insert>
    
<!-- 파일 테이블에 데이터 추가 -->
	
	
	<insert id="insertProcessFile" parameterType="java.util.Map" > 
	    <foreach collection="list" item="item" index="index" open="INSERT ALL" close="SELECT * FROM DUAL" separator=" ">
	    	 
			into 
		   	attach_file
		   		(
		   			file_seq, 
		   			file_detail_seq, 
		   			file_real_name, 
		   			file_save_name, 
		   			file_path, 
		   			in_user_id, 
		   			in_date, 
		   			up_user_id, 
		   			up_date
		   		)
			values 
	        
	        (
		    	(
		    		select 
						NVL(max(to_number(file_seq)),0) + 1 
        			from 
        				attach_file),
        			#{item.fileDetailSeq}, 
        			#{item.fileRealName}, 
        			#{item.fileSaveName}, 
        			#{item.filePath}, 
        			#{item.inUserId}, 
        			sysdate, 
        			#{item.upUserId, jdbcType=VARCHAR}, 
        			sysdate
        	)
	        
	        
	    </foreach>
	</insert>
	

</mapper>